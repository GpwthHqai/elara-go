<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Billing â€” Elara Go</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <link rel='preconnect' href='https://fonts.googleapis.com'>
  <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
  <link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap' rel='stylesheet'>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo"></div>
        <span>Elara Go</span>
      </div>
      <nav class="nav-links">
        <a href="/app" class="ghost">Dashboard</a>
        <a href="/logout" class="ghost">Logout</a>
      </nav>
    </div>
  </header>

  <main class="container main">
    <div style="max-width: 800px; margin: 0 auto;">
      <h1 style="margin-bottom: 2rem;">Billing & Subscription</h1>
      
      <div class="card" style="margin-bottom: 2rem;">
        <h2 style="margin-bottom: 1.5rem;">Current Plan</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div>
            <div class="kpi">
              <div class="label">Plan</div>
              <div class="value" style="font-size: 1.5rem; text-transform: capitalize;">
                {% if user['plan'] == 'pro-6mo' %}
                  Pro (6 Months)
                {% elif user['plan'] == 'pro' %}
                  Pro (Monthly)
                {% else %}
                  Free
                {% endif %}
              </div>
            </div>
          </div>
          <div>
            <div class="kpi">
              <div class="label">Status</div>
              <div class="value" style="font-size: 1.5rem;">
                {% if user['plan'] != 'free' %}
                  <span style="color: var(--accent);">Active</span>
                {% else %}
                  <span style="color: var(--text-muted);">Free</span>
                {% endif %}
              </div>
            </div>
          </div>
          {% if renewal_iso %}
          <div>
            <div class="kpi">
              <div class="label">Next Billing</div>
              <div class="value" style="font-size: 1rem;">{{ renewal_iso }}</div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      {% if user['plan'] == 'free' %}
      <div class="card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%); border-color: rgba(59, 130, 246, 0.2); margin-bottom: 2rem;">
        <h3 style="margin-bottom: 1rem;">ðŸš€ Upgrade to Pro</h3>
        <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
          Unlock advanced analytics, unlimited data history, premium integrations, and more.
        </p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
          <div style="padding: 1rem; background: rgba(255, 255, 255, 0.02); border-radius: 8px; border: 1px solid var(--border-light);">
            <h4 style="margin-bottom: 0.5rem;">6-Month Plan</h4>
            <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent); margin-bottom: 0.5rem;">$72</div>
            <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">$12/month â€¢ Save 40%</div>
            <form method='POST' action='/checkout/6month' style="width: 100%;">
              <button type='submit' class='btn btn-accent' style="width: 100%; justify-content: center;">
                Choose 6-Month Plan
              </button>
            </form>
          </div>
          
          <div style="padding: 1rem; background: rgba(255, 255, 255, 0.02); border-radius: 8px; border: 1px solid var(--border-light);">
            <h4 style="margin-bottom: 0.5rem;">Monthly Plan</h4>
            <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary-light); margin-bottom: 0.5rem;">$20</div>
            <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">per month</div>
            <button class='ghost' style="width: 100%; justify-content: center;" disabled>
              Coming Soon
            </button>
          </div>
        </div>

        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.2);">
          <p style="margin: 0; font-size: 0.875rem; color: var(--accent);">
            <strong>ðŸ’¡ Why 6 months?</strong> Research shows it takes 66 days on average to form a habit. 
            Give yourself the full journey to transformation with our most popular plan.
          </p>
        </div>
      </div>
      {% endif %}

      <div class="card">
        <h3 style="margin-bottom: 1rem;">Manage Subscription</h3>
        <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
          Update payment methods, view billing history, or manage your subscription through Stripe's secure portal.
        </p>
        
        <form id="portalForm" method="POST" action="/billing/portal">
          <button class="btn" type="submit">Open Customer Portal</button>
        </form>
      </div>

      {% if user['plan'] != 'free' %}
      <div class="card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1rem;">Pro Features You're Enjoying</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <div class="badge">ðŸ“Š Advanced Analytics</div>
          <div class="badge">ðŸ”„ All Integrations</div>
          <div class="badge">ðŸ“ˆ Unlimited History</div>
          <div class="badge">ðŸŽ¯ Goal Tracking</div>
          <div class="badge">ðŸ“… Calendar Sync</div>
          <div class="badge">âŒš Health Apps</div>
          <div class="badge">ðŸ“‹ Custom Templates</div>
          <div class="badge">ðŸ’¾ Data Export</div>
          <div class="badge">ðŸŽ§ Priority Support</div>
        </div>
      </div>
      {% endif %}
    </div>
  </main>

  <script>
    const form = document.getElementById('portalForm');
    if(form){
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          const res = await fetch('/billing/portal', { method:'POST' });
          const data = await res.json();
          if(data.url) {
            window.location = data.url;
          } else {
            alert('Unable to open billing portal. Please try again or contact support.');
          }
        } catch (error) {
          console.error('Error opening billing portal:', error);
          alert('Unable to open billing portal. Please try again or contact support.');
        }
      });
    }
  </script>
</body>
</html>